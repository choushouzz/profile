{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{render}from\"react-dom\";import{Route,Switch,BrowserRouter,Redirect}from'react-router-dom';import'./App.css';import Login from'./react-components/Login';import Dashboard from'./react-components/Dashboard';import UserForm from'./react-components/RequestForm';import{LinearProgress}from'@material-ui/core';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.login=function(user,pwd,isAdmin){console.log(\"StopGap: Logging in...\");if(_this.state.loggedIn){//already logged in.\nconsole.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false});_this.setState({loggedIn:true});return;}// validate token\nfetch(\"/api/token/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":user,\"password\":pwd})}).then(function(res){return res.json();}).then(function(res){console.log(res);if('detail'in res){localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');_this.setState({loggedIn:false,invalidLogin:true});}else if('access'in res&&'refresh'in res){localStorage.setItem('token-access',res.access);localStorage.setItem('token-refresh',res.refresh);_this.setState({loggedIn:true,isAdmin:isAdmin,invalidLogin:false});}},function(err){_this.setState({loggedIn:false,invalidLogin:true});console.error(err);});};_this.register=function(username,password,first_name,last_name,isAdmin){console.log(\"StopGap: Registering new user...\");// User already logged in.\nif(_this.state.loggedIn){console.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false});_this.setState({loggedIn:true});return;}// Register user using Django API\nfetch(\"/users/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":username,\"password\":password,\"email\":username,\"first_name\":first_name,\"last_name\":last_name,\"is_staff\":isAdmin})}).then(function(res){// Login user with newly created credentials\n_this.login(username,password,isAdmin);});};_this.logout=function(){_this.setState({loggedIn:false,isAdmin:false,invalidLogin:false});localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');};_this.state={loggedIn:false,// by default, no one is logged in\ninvalidLogin:false,isAdmin:true,// TODO: properly store this\nisCurrentlyCheckingStorageForLogin:true};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var refreshToken=localStorage.hasOwnProperty(\"token-access\")&&localStorage.hasOwnProperty(\"token-refresh\")?localStorage.getItem(\"token-refresh\"):\"\";// check if the existing token is valid.\nfetch(\"/api/token/refresh/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({refresh:refreshToken})}).then(function(res){return res.json();}).then(function(res){if('access'in res){localStorage.setItem(\"token-access\",res.access);_this2.setState({loggedIn:true,isCurrentlyCheckingStorageForLogin:false});}else{_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});}},function(error){console.error(error);_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(Switch,null,\" \",/*#__PURE__*/React.createElement(Route,{path:\"/login\",render:function render(){return/*#__PURE__*/React.createElement(Login,{loggedIn:_this3.state.loggedIn,login:_this3.login,register:_this3.register,isAdmin:_this3.state.isAdmin,invalidLogin:_this3.state.invalidLogin});}}),/*#__PURE__*/React.createElement(Route,{path:\"/dashboard\",render:function render(){return _this3.state.loggedIn?/*#__PURE__*/React.createElement(Dashboard,{loggedIn:_this3.state.loggedIn,isAdmin:_this3.state.isAdmin,logout:_this3.logout}):/*#__PURE__*/React.createElement(Redirect,{to:\"/login\"});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/form\",render:function render(){return/*#__PURE__*/React.createElement(UserForm,null);}}),/*#__PURE__*/React.createElement(Route,{path:\"/\",render:function render(){return _this3.state.isCurrentlyCheckingStorageForLogin?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"Loading . . .\"),/*#__PURE__*/React.createElement(LinearProgress,null)):/*#__PURE__*/React.createElement(Redirect,{path:\"/\",to:_this3.state.loggedIn?\"/dashboard\":\"/login\"});}}))));}}]);return App;}(React.Component);export default App;var container=document.getElementById(\"root\");render(/*#__PURE__*/React.createElement(App,null),container);","map":{"version":3,"sources":["C:/Users/owner/desktop/team/app/src/components/App.js"],"names":["React","render","Route","Switch","BrowserRouter","Redirect","Login","Dashboard","UserForm","LinearProgress","App","props","login","user","pwd","isAdmin","console","log","state","loggedIn","error","setState","fetch","method","headers","body","JSON","stringify","then","res","json","localStorage","removeItem","invalidLogin","setItem","access","refresh","err","register","username","password","first_name","last_name","logout","isCurrentlyCheckingStorageForLogin","refreshToken","hasOwnProperty","getItem","Component","container","document","getElementById"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { render } from \"react-dom\";\r\nimport { Route, Switch, BrowserRouter, Redirect } from 'react-router-dom';\r\nimport './App.css';\r\nimport Login from './react-components/Login';\r\nimport Dashboard from './react-components/Dashboard';\r\nimport UserForm from './react-components/RequestForm';\r\nimport { LinearProgress } from '@material-ui/core';\r\nclass App extends React.Component {\r\n\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      loggedIn: false, // by default, no one is logged in\r\n      invalidLogin: false,\r\n      isAdmin: true, // TODO: properly store this\r\n      isCurrentlyCheckingStorageForLogin: true\r\n    };\r\n  }\r\n\r\n  login = (user, pwd, isAdmin) => {\r\n    console.log(\"StopGap: Logging in...\");\r\n    if (this.state.loggedIn){ //already logged in.\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false\r\n      });\r\n      this.setState({\r\n        loggedIn: true\r\n      });\r\n      return;\r\n    }\r\n    // validate token\r\n    fetch(\"/api/token/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": user,\r\n        \"password\": pwd\r\n      })\r\n    })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n      console.log(res)\r\n      if ('detail' in res){\r\n        localStorage.removeItem('token-access')\r\n        localStorage.removeItem('token-refresh')\r\n        this.setState({\r\n          loggedIn: false,\r\n          invalidLogin: true\r\n        });\r\n      } else if ('access' in res && 'refresh' in res){\r\n        localStorage.setItem('token-access', res.access);\r\n        localStorage.setItem('token-refresh', res.refresh);\r\n        this.setState({\r\n          loggedIn: true,\r\n          isAdmin: isAdmin,\r\n          invalidLogin: false\r\n        });\r\n      }\r\n    }, err => {\r\n      this.setState({\r\n        loggedIn: false,\r\n        invalidLogin: true\r\n      });\r\n      console.error(err);\r\n    })\r\n  }\r\n\r\n  register = (username, password, first_name, last_name, isAdmin) => {\r\n    console.log(\"StopGap: Registering new user...\");\r\n\r\n    // User already logged in.\r\n    if (this.state.loggedIn){\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false\r\n      });\r\n      this.setState({\r\n        loggedIn: true\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Register user using Django API\r\n    fetch(\"/users/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": username,\r\n        \"password\": password,\r\n        \"email\": username,\r\n        \"first_name\": first_name,\r\n        \"last_name\": last_name,\r\n        \"is_staff\": isAdmin\r\n      })\r\n    }).then(res => {\r\n      // Login user with newly created credentials\r\n      this.login(username, password, isAdmin);\r\n    });\r\n  }\r\n\r\n  logout = () => {\r\n    this.setState({\r\n      loggedIn: false,\r\n      isAdmin: false,\r\n      invalidLogin: false\r\n    });\r\n    localStorage.removeItem('token-access');\r\n    localStorage.removeItem('token-refresh');\r\n  }\r\n\r\n  \r\n  componentDidMount() {\r\n    const refreshToken = localStorage.hasOwnProperty(\"token-access\") &&  localStorage.hasOwnProperty(\"token-refresh\") \r\n      ? localStorage.getItem(\"token-refresh\")\r\n      : \"\";\r\n    // check if the existing token is valid.\r\n    fetch(\"/api/token/refresh/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        refresh: refreshToken\r\n      })\r\n    })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n        if ('access' in res){\r\n          localStorage.setItem(\"token-access\", res.access)\r\n          this.setState({\r\n            loggedIn: true,\r\n            isCurrentlyCheckingStorageForLogin: false\r\n          })\r\n        } else {\r\n          this.setState({\r\n            loggedIn: false,\r\n            isCurrentlyCheckingStorageForLogin: false\r\n          })\r\n        }\r\n    }, error => {\r\n      console.error(error)\r\n      this.setState({\r\n        loggedIn: false,\r\n        isCurrentlyCheckingStorageForLogin: false\r\n      })\r\n    });\r\n  }\r\n\r\n  render() { \r\n      return (\r\n        <div> \r\n          <BrowserRouter>\r\n            <Switch> { /* Similar to a switch statement - shows the component depending on the URL path */ }\r\n              { /* Each Route below shows a different component depending on the exact path in the URL  */ }\r\n              <Route\r\n                path='/login'\r\n                render={() => (\r\n                  <Login loggedIn={this.state.loggedIn}\r\n                  login={this.login}\r\n                  register={this.register}\r\n                  isAdmin={this.state.isAdmin}\r\n                  invalidLogin={this.state.invalidLogin} />\r\n                )}\r\n              />\r\n              <Route path='/dashboard' render={() => (\r\n                this.state.loggedIn \r\n                  ? <Dashboard loggedIn={this.state.loggedIn} isAdmin={this.state.isAdmin} logout={this.logout} />\r\n                  : <Redirect to='/login' />\r\n              )} />\r\n              <Route exact path='/form' render={() => (<UserForm />)}/>\r\n              <Route path='/' render={() => (\r\n                this.state.isCurrentlyCheckingStorageForLogin \r\n                  ? (<div>\r\n                      <h1>Loading . . .</h1>\r\n                      <LinearProgress />\r\n                    </div>)\r\n                  : <Redirect path='/' to={this.state.loggedIn ? \"/dashboard\" : \"/login\" } />\r\n              )} />\r\n            </Switch>\r\n            \r\n          </BrowserRouter>\r\n        </div>\r\n      )\r\n  }\r\n}\r\n\r\n\r\nexport default App;\r\nconst container = document.getElementById(\"root\");\r\nrender(<App />, container);\r\n"]},"metadata":{},"sourceType":"module"}