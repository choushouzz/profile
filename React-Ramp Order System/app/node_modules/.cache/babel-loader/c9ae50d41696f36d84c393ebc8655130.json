{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{render}from\"react-dom\";import{Route,Switch,BrowserRouter,Redirect}from'react-router-dom';import'./App.css';import Login from'./react-components/Login';import Dashboard from'./react-components/Dashboard';import UserForm from'./react-components/RequestForm';import{LinearProgress}from'@material-ui/core';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.login=function(user,pwd,isAdmin){console.log(\"StopGap: Logging in...\");if(_this.state.loggedIn){//already logged in.\nconsole.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false,username:\"\"});_this.setState({loggedIn:true,username:user});return;}// validate token\nfetch(\"/api/token/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":user,\"password\":pwd})}).then(function(res){return res.json();}).then(function(res){console.log(res);if('detail'in res){localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');_this.setState({loggedIn:false,invalidLogin:true,username:user});}else if('access'in res&&'refresh'in res){localStorage.setItem('token-access',res.access);localStorage.setItem('token-refresh',res.refresh);_this.setState({loggedIn:true,// isAdmin: isAdmin,\ninvalidLogin:false,username:_this.user});}},function(err){_this.setState({loggedIn:false,invalidLogin:true,username:\"\"});console.error(err);});};_this.register=function(username,password,first_name,last_name,isAdmin){console.log(\"StopGap: Registering new user...\");// User already logged in.\nif(_this.state.loggedIn){console.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false});_this.setState({loggedIn:true,username:username});return;}// Register user using Django API\nfetch(\"/users/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":username,\"password\":password,\"email\":username,\"first_name\":first_name,\"last_name\":last_name,\"is_staff\":isAdmin})}).then(function(res){// Login user with newly created credentials\n_this.login(username,password,isAdmin);});};_this.logout=function(){_this.setState({loggedIn:false,isAdmin:false,invalidLogin:false,username:\"\"});localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');};_this.state={loggedIn:false,// by default, no one is logged in\ninvalidLogin:false,isAdmin:true,// TODO: properly store this\nisCurrentlyCheckingStorageForLogin:true,users:[],username:\"\",error:null,isLoaded:false};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var refreshToken=localStorage.hasOwnProperty(\"token-access\")&&localStorage.hasOwnProperty(\"token-refresh\")?localStorage.getItem(\"token-refresh\"):\"\";// check if the existing token is valid.\nfetch(\"/api/token/refresh/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({refresh:refreshToken})}).then(function(res){return res.json();}).then(function(res){if('access'in res){localStorage.setItem(\"token-access\",res.access);_this2.setState({loggedIn:true,isCurrentlyCheckingStorageForLogin:false});}else{_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});}},function(error){console.error(error);_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});});fetch(\"/users\",{method:'GET',headers:{'Accept':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token-access'))}}).then(function(res){if(res.ok)return res.json();throw new Error(\"Something went wrong with error code \".concat(res.status));}).then(function(result){var users=result[\"results\"];_this2.setState({users:users,isLoaded:true});// console.log(username)\n// users.map(x => {\n//   console.log(x[\"username\"])\n//   if (x[\"username\"] == username){\n//       id = x[\"pk\"]\n//   }\n// })\n},// Note: it's important to handle errors here\n// instead of a catch() block so that we don't swallow\n// exceptions from actual bugs in components.\nfunction(error){_this2.setState({isLoaded:true,error:error});});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(Switch,null,\" \",/*#__PURE__*/React.createElement(Route,{path:\"/login\",render:function render(){return/*#__PURE__*/React.createElement(Login,{loggedIn:_this3.state.loggedIn,login:_this3.login,register:_this3.register,isAdmin:_this3.state.isAdmin,invalidLogin:_this3.state.invalidLogin});}}),/*#__PURE__*/React.createElement(Route,{path:\"/dashboard\",render:function render(){return _this3.state.loggedIn?/*#__PURE__*/React.createElement(Dashboard,{username:_this3.state.username,users:_this3.state.users,loggedIn:_this3.state.loggedIn,isAdmin:_this3.state.isAdmin,logout:_this3.logout}):/*#__PURE__*/React.createElement(Redirect,{to:\"/login\"});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/form\",render:function render(){return/*#__PURE__*/React.createElement(UserForm,null);}}),/*#__PURE__*/React.createElement(Route,{path:\"/\",render:function render(){return _this3.state.isCurrentlyCheckingStorageForLogin?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"Loading . . .\"),/*#__PURE__*/React.createElement(LinearProgress,null)):/*#__PURE__*/React.createElement(Redirect,{path:\"/\",to:_this3.state.loggedIn?\"/dashboard\":\"/login\"});}}))));}}]);return App;}(React.Component);export default App;var container=document.getElementById(\"root\");render(/*#__PURE__*/React.createElement(App,null),container);","map":{"version":3,"sources":["C:/Users/owner/desktop/team/app/src/components/App.js"],"names":["React","render","Route","Switch","BrowserRouter","Redirect","Login","Dashboard","UserForm","LinearProgress","App","props","login","user","pwd","isAdmin","console","log","state","loggedIn","error","setState","username","fetch","method","headers","body","JSON","stringify","then","res","json","localStorage","removeItem","invalidLogin","setItem","access","refresh","err","register","password","first_name","last_name","logout","isCurrentlyCheckingStorageForLogin","users","isLoaded","refreshToken","hasOwnProperty","getItem","ok","Error","status","result","Component","container","document","getElementById"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { render } from \"react-dom\";\r\nimport { Route, Switch, BrowserRouter, Redirect } from 'react-router-dom';\r\nimport './App.css';\r\nimport Login from './react-components/Login';\r\nimport Dashboard from './react-components/Dashboard';\r\nimport UserForm from './react-components/RequestForm';\r\nimport { LinearProgress } from '@material-ui/core';\r\nclass App extends React.Component {\r\n\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      loggedIn: false, // by default, no one is logged in\r\n      invalidLogin: false,\r\n      isAdmin: true, // TODO: properly store this\r\n      isCurrentlyCheckingStorageForLogin: true,\r\n      users:[],\r\n      username:\"\",\r\n      error: null,\r\n      isLoaded: false,\r\n      \r\n    };\r\n  }\r\n\r\n  login = (user, pwd, isAdmin) => {\r\n    console.log(\"StopGap: Logging in...\");\r\n    if (this.state.loggedIn){ //already logged in.\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false,\r\n        username:\"\"\r\n      });\r\n      this.setState({\r\n        loggedIn: true,\r\n        username:user\r\n      });\r\n      return;\r\n    }\r\n    // validate token\r\n    fetch(\"/api/token/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": user,\r\n        \"password\": pwd\r\n      })\r\n    })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n      console.log(res)\r\n      if ('detail' in res){\r\n        localStorage.removeItem('token-access')\r\n        localStorage.removeItem('token-refresh')\r\n        this.setState({\r\n          loggedIn: false,\r\n          invalidLogin: true,\r\n          username:user\r\n        });\r\n      } else if ('access' in res && 'refresh' in res){\r\n        localStorage.setItem('token-access', res.access);\r\n        localStorage.setItem('token-refresh', res.refresh);\r\n        this.setState({\r\n          loggedIn: true,\r\n          // isAdmin: isAdmin,\r\n          invalidLogin: false,\r\n          username:this.user\r\n        });\r\n      }\r\n    }, err => {\r\n      this.setState({\r\n        loggedIn: false,\r\n        invalidLogin: true,\r\n        username:\"\"\r\n      });\r\n      console.error(err);\r\n    })\r\n  }\r\n\r\n  register = (username, password, first_name, last_name, isAdmin) => {\r\n    console.log(\"StopGap: Registering new user...\");\r\n\r\n    // User already logged in.\r\n    if (this.state.loggedIn){\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false\r\n      });\r\n      this.setState({\r\n        loggedIn: true,\r\n        username:username\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Register user using Django API\r\n    fetch(\"/users/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": username,\r\n        \"password\": password,\r\n        \"email\": username,\r\n        \"first_name\": first_name,\r\n        \"last_name\": last_name,\r\n        \"is_staff\": isAdmin\r\n      })\r\n    }).then(res => {\r\n      // Login user with newly created credentials\r\n      this.login(username, password, isAdmin);\r\n    });\r\n  }\r\n\r\n  logout = () => {\r\n    this.setState({\r\n      loggedIn: false,\r\n      isAdmin: false,\r\n      invalidLogin: false,\r\n      username:\"\"\r\n    });\r\n    localStorage.removeItem('token-access');\r\n    localStorage.removeItem('token-refresh');\r\n  }\r\n\r\n  \r\n  componentDidMount() {\r\n    const refreshToken = localStorage.hasOwnProperty(\"token-access\") &&  localStorage.hasOwnProperty(\"token-refresh\") \r\n      ? localStorage.getItem(\"token-refresh\")\r\n      : \"\";\r\n    // check if the existing token is valid.\r\n    fetch(\"/api/token/refresh/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        refresh: refreshToken\r\n      })\r\n    })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n        if ('access' in res){\r\n          localStorage.setItem(\"token-access\", res.access)\r\n          this.setState({\r\n            loggedIn: true,\r\n            isCurrentlyCheckingStorageForLogin: false\r\n          })\r\n        } else {\r\n          this.setState({\r\n            loggedIn: false,\r\n            isCurrentlyCheckingStorageForLogin: false\r\n          })\r\n        }\r\n    }, error => {\r\n      console.error(error)\r\n      this.setState({\r\n        loggedIn: false,\r\n        isCurrentlyCheckingStorageForLogin: false\r\n      })\r\n    });\r\n\r\n\r\n    fetch(\"/users\", {\r\n      method: 'GET',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Authorization': `Bearer ${localStorage.getItem('token-access')}`\r\n      }\r\n    })\r\n    .then(res => {\r\n      if (res.ok)\r\n        return res.json()\r\n      throw new Error(`Something went wrong with error code ${res.status}`)\r\n    })\r\n    .then(\r\n      (result) => {\r\n        const users = result[\"results\"];\r\n        this.setState({\r\n          users:users,\r\n          isLoaded: true,\r\n        })\r\n        // console.log(username)\r\n        // users.map(x => {\r\n        //   console.log(x[\"username\"])\r\n        //   if (x[\"username\"] == username){\r\n        //       id = x[\"pk\"]\r\n              \r\n        //   }\r\n        // })\r\n        \r\n      },\r\n      // Note: it's important to handle errors here\r\n      // instead of a catch() block so that we don't swallow\r\n      // exceptions from actual bugs in components.\r\n      (error) => {\r\n        this.setState({\r\n          isLoaded: true,\r\n          error\r\n        });\r\n             \r\n      }\r\n    )\r\n\r\n   \r\n  }\r\n\r\n\r\n\r\n    \r\n\r\n    \r\n\r\n\r\n  render() { \r\n      return (\r\n        <div> \r\n          <BrowserRouter>\r\n            <Switch> { /* Similar to a switch statement - shows the component depending on the URL path */ }\r\n              { /* Each Route below shows a different component depending on the exact path in the URL  */ }\r\n              <Route\r\n                path='/login'\r\n                render={() => (\r\n                  <Login loggedIn={this.state.loggedIn}\r\n                  login={this.login}\r\n                  register={this.register}\r\n                  isAdmin={this.state.isAdmin}\r\n                  invalidLogin={this.state.invalidLogin} />\r\n                )}\r\n              />\r\n              <Route path='/dashboard' render={() => (\r\n                this.state.loggedIn \r\n                  ? <Dashboard username = {this.state.username} users = {this.state.users} loggedIn={this.state.loggedIn} isAdmin={this.state.isAdmin} logout={this.logout} />\r\n                  : <Redirect to='/login' />\r\n              )} />\r\n              <Route exact path='/form' render={() => (<UserForm />)}/>\r\n              <Route path='/' render={() => (\r\n                this.state.isCurrentlyCheckingStorageForLogin \r\n                  ? (<div>\r\n                      <h1>Loading . . .</h1>\r\n                      <LinearProgress />\r\n                    </div>)\r\n                  : <Redirect path='/' to={this.state.loggedIn ? \"/dashboard\" : \"/login\" } />\r\n              )} />\r\n            </Switch>\r\n            \r\n          </BrowserRouter>\r\n        </div>\r\n      )\r\n  }\r\n}\r\n\r\n\r\nexport default App;\r\nconst container = document.getElementById(\"root\");\r\nrender(<App />, container);\r\n"]},"metadata":{},"sourceType":"module"}