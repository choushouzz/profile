{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import FormUserDetails from'./FormUserDetails';import ImageUpload from'./ImageUpload';import LiabilityWaiver from'./LiabilityWaiver';import{Redirect,Link}from'react-router-dom';export var UserForm=/*#__PURE__*/function(_Component){_inherits(UserForm,_Component);var _super=_createSuper(UserForm);function UserForm(props){var _this;_classCallCheck(this,UserForm);_this=_super.call(this,props);_this.nextStep=function(){var step=_this.state.step;_this.setState({step:step+1});};_this.prevStep=function(){var step=_this.state.step;_this.setState({step:step-1});};_this.handleChange=function(input){return function(e){_this.setState(_defineProperty({},input,e.target.value));if(_this.state.rightStepHeight!=''&&_this.state.leftStepHeight!=''&&_this.state.entrywayPhoto!=''&&_this.state.stepLeftPhoto!=''&&_this.state.stepRightPhoto!=''){_this.setState({Uploaded:true});}};};_this.handleCheck=function(input){return function(e){_this.setState(_defineProperty({},input,!_this.state.subsidize));};};_this.handleUser=function(){_this.props.verifyTokens().then(function(valid){if(!valid)return;fetch(\"/users\",{method:'GET',headers:{'Accept':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token-access'))}}).then(function(res){if(res.ok)return res.json();throw new Error(\"Something went wrong with error code \".concat(res.status));}).then(function(result){var users=result[\"results\"];var id;users.map(function(x){if(x[\"username\"]==_this.props.username){id=x[\"pk\"];}});_this.setState({isLoaded:true,user:id});_this.handleSubmitWaiver();},// Note: it's important to handle errors here\n// instead of a catch() block so that we don't swallow\n// exceptions from actual bugs in components.\nfunction(error){_this.setState({isLoaded:true,error:error});});});};_this.handleSubmitOrder=function(){var data={// \"pk\":1,\n\"user\":_this.state.user,\"first_name\":_this.state.firstName,\"last_name\":_this.state.lastName,\"email\":_this.state.email,\"company\":_this.state.companyName,\"phone_number\":_this.state.phoneNumber,\"billing_address\":_this.state.deliveryAddress,\"shipping_address\":_this.state.billingAddress,\"waiver\":_this.state.waiver,\"entryway_photo\":_this.state.entrywayPhoto,\"step_left_photo\":_this.state.stepLeftPhoto,\"step_right_photo\":_this.state.stepRightPhoto,\"step_left_height\":_this.state.leftStepHeight,\"step_right_height\":_this.state.rightStepHeight,\"ramp_colour\":_this.state.rampColor,\"delivery_method\":_this.state.deliveryType,\"subsidize\":_this.state.subsidize,\"status\":0,\"notes\":\"[]\"};_this.props.verifyTokens().then(function(valid){if(!valid)return;var token=localStorage.getItem('token-access');var requestOptions={method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(data)};fetch('/order-information/',requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var data,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return response.json();case 2:data=_context.sent;if(response.ok){_context.next=6;break;}// get error message from body or default to response status\nerror=data&&data.message||response.status;return _context.abrupt(\"return\",Promise.reject(error));case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){_this.setState({errorMessage:error});console.error('There was an error!',error);console.log(error);});});};_this.handleSubmitWaiver=function(){var data={//\"pk\":1,\n\"user\":_this.state.user,\"signatory_first_name\":_this.state.managerFirst,\"signatory_last_name\":_this.state.managerFirst,\"signatory_signature\":_this.state.witnessSig,\"witness_first_name\":_this.state.witnessName,\"witness_last_name\":_this.state.witnessName,\"witness_signature\":_this.state.witnessSig};_this.props.verifyTokens().then(function(valid){if(!valid)return;var token=localStorage.getItem('token-access');console.log(token);var requestOptions={method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(data)};fetch('/waiver-information/',requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return response.json();case 2:data=_context2.sent;if(response.ok){_context2.next=6;break;}// get error message from body or default to response status\nerror=data&&data.message||response.status;return _context2.abrupt(\"return\",Promise.reject(error));case 6:_this.setState({waiver:data.pk});_this.handleSubmitOrder();case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){_this.setState({errorMessage:error});console.error('There was an error!',JSON.stringify(data));});});};_this.state={step:1,firstName:'',lastName:'',email:'',companyName:'',phoneNumber:'',deliveryAddress:'',deliveryType:'',rampColor:'',managerFirst:'',managerSig:'',witnessName:'',witnessSig:'',entrywayPhoto:'',stepLeftPhoto:'',stepRightPhoto:'',leftStepHeight:'',rightStepHeight:'',subsidize:false,waiver:'',user:'',isLoaded:false,Uploaded:false};_this.handlePicture=_this.handlePicture.bind(_assertThisInitialized(_this));return _this;}_createClass(UserForm,[{key:\"handlePicture\",value:function handlePicture(input,url){if(input==\"entrywayPhoto\"){this.setState({entrywayPhoto:url});}else if(input==\"stepLeftPhoto\"){this.setState({stepLeftPhoto:url});}else if(input==\"stepRightPhoto\"){this.setState({stepRightPhoto:url});}if(this.state.rightStepHeight!=''&&this.state.leftStepHeight!=''&&this.state.entrywayPhoto!=''&&this.state.stepLeftPhoto!=''&&this.state.stepRightPhoto!=''){this.setState({Uploaded:true});}}},{key:\"render\",value:function render(){var step=this.state.step;switch(step){case 0:return/*#__PURE__*/React.createElement(Redirect,{to:\"/dashboard\"});case 1:return/*#__PURE__*/React.createElement(FormUserDetails,{prevStep:this.prevStep,nextStep:this.nextStep,handleChange:this.handleChange,handleCheck:this.handleCheck});case 2:return/*#__PURE__*/React.createElement(ImageUpload,{prevStep:this.prevStep,nextStep:this.nextStep,handlePicture:this.handlePicture,handleChange:this.handleChange,Uploaded:this.state.Uploaded});case 3:return/*#__PURE__*/React.createElement(LiabilityWaiver,{nextStep:this.nextStep,prevStep:this.prevStep,handleSubmitWaiver:this.handleSubmitWaiver,handleSubmitOrder:this.handleSubmitOrder,handleUser:this.handleUser,handleChange:this.handleChange});case 4:return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\" Thank you! We'll be in contact about your request.\"),/*#__PURE__*/React.createElement(Link,{to:\"/dashboard\"},\"Go back home.\"));default:return/*#__PURE__*/React.createElement(Redirect,{to:\"/dashboard\"});}// return (\n//     <div>\n//     </div>\n}}]);return UserForm;}(Component);export default UserForm;","map":{"version":3,"sources":["C:/Users/owner/desktop/team/app/src/components/react-components/RequestForm/index.js"],"names":["React","Component","FormUserDetails","ImageUpload","LiabilityWaiver","Redirect","Link","UserForm","props","nextStep","step","state","setState","prevStep","handleChange","input","e","target","value","rightStepHeight","leftStepHeight","entrywayPhoto","stepLeftPhoto","stepRightPhoto","Uploaded","handleCheck","subsidize","handleUser","verifyTokens","then","valid","fetch","method","headers","localStorage","getItem","res","ok","json","Error","status","result","users","id","map","x","username","isLoaded","user","handleSubmitWaiver","error","handleSubmitOrder","data","firstName","lastName","email","companyName","phoneNumber","deliveryAddress","billingAddress","waiver","rampColor","deliveryType","token","requestOptions","body","JSON","stringify","response","message","Promise","reject","catch","errorMessage","console","log","managerFirst","witnessSig","witnessName","pk","managerSig","handlePicture","bind","url"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport FormUserDetails from './FormUserDetails';\r\nimport ImageUpload from './ImageUpload';\r\nimport LiabilityWaiver from './LiabilityWaiver';\r\nimport { Redirect, Link } from 'react-router-dom';\r\n\r\nexport class UserForm extends Component {\r\n\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        \r\n\r\n        this.state = {\r\n            step: 1, \r\n            firstName: '',\r\n            lastName: '',\r\n            email: '',\r\n            companyName: '',\r\n            phoneNumber: '', \r\n            deliveryAddress: '',\r\n            deliveryType: '',\r\n            rampColor: '',\r\n            managerFirst: '',\r\n            managerSig: '',\r\n            witnessName: '',\r\n            witnessSig: '',\r\n            entrywayPhoto: '',\r\n            stepLeftPhoto: '',\r\n            stepRightPhoto: '',\r\n            leftStepHeight:'',\r\n            rightStepHeight:'',\r\n            subsidize: false,\r\n            waiver:'',\r\n            user: '',\r\n            isLoaded: false,\r\n            Uploaded:false,\r\n        }\r\n\r\n        this.handlePicture = this.handlePicture.bind(this)\r\n    }\r\n\r\n\r\n    nextStep = () => {\r\n        const { step } = this.state;\r\n        this.setState({\r\n            step: step + 1\r\n        });\r\n    }\r\n\r\n    prevStep = () => {\r\n        const { step } = this.state;\r\n        this.setState({\r\n            step: step - 1\r\n        });\r\n    }\r\n    // Handle Field Changes\r\n    handleChange = input => e => {\r\n        this.setState({[input]: e.target.value})\r\n        if (this.state.rightStepHeight != '' && this.state.leftStepHeight != ''  &&\r\n        this.state.entrywayPhoto != '' && this.state.stepLeftPhoto != '' && this.state.stepRightPhoto != ''){\r\n            this.setState({\r\n                Uploaded: true\r\n            });\r\n            \r\n        }\r\n    }\r\n\t\r\n\thandleCheck = input => e => {\r\n        this.setState({[input]: !this.state.subsidize})\r\n    }\r\n\r\n    handlePicture(input, url) {\r\n\r\n        \r\n\r\n        if (input == \"entrywayPhoto\") {\r\n            this.setState({\r\n                entrywayPhoto: url\r\n            });\r\n        } else if (input == \"stepLeftPhoto\") {\r\n            this.setState({\r\n                stepLeftPhoto: url\r\n            });\r\n        } else if (input == \"stepRightPhoto\") {\r\n            this.setState({\r\n                stepRightPhoto: url\r\n            });\r\n        }\r\n\r\n        if (this.state.rightStepHeight != '' && this.state.leftStepHeight != ''  &&\r\n        this.state.entrywayPhoto != '' && this.state.stepLeftPhoto != '' && this.state.stepRightPhoto != ''){\r\n            this.setState({\r\n                Uploaded: true\r\n            });\r\n            \r\n        }\r\n    }\r\n\r\n\r\n    handleUser = () => {\r\n        this.props.verifyTokens().then(valid => {\r\n            if (!valid)\r\n                return;\r\n            fetch(\"/users\", {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Accept': 'application/json',\r\n                    'Authorization': `Bearer ${localStorage.getItem('token-access')}`\r\n                }\r\n                })\r\n                .then(res => {\r\n                if (res.ok)\r\n                    return res.json()\r\n                throw new Error(`Something went wrong with error code ${res.status}`)\r\n                })\r\n                .then(\r\n                (result) => {\r\n                    const users = result[\"results\"];\r\n                    var id\r\n                    users.map(x => {\r\n                    if (x[\"username\"] == this.props.username){\r\n                        id = x[\"pk\"]\r\n            \r\n                        \r\n                    }\r\n                    })\r\n                    this.setState({\r\n                    isLoaded: true,\r\n                    user:id\r\n                    });\r\n                    this.handleSubmitWaiver()\r\n                },\r\n                // Note: it's important to handle errors here\r\n                // instead of a catch() block so that we don't swallow\r\n                // exceptions from actual bugs in components.\r\n                (error) => {\r\n                    this.setState({\r\n                    isLoaded: true,\r\n                    error\r\n                    });\r\n                }\r\n            )\r\n        });\r\n    }\r\n\t\r\n    handleSubmitOrder = () => {\r\n        const data ={\r\n        // \"pk\":1,\r\n        \"user\":this.state.user,\r\n        \"first_name\":this.state.firstName,\r\n        \"last_name\":this.state.lastName,\r\n        \"email\":this.state.email,\r\n        \"company\":this.state.companyName,\r\n        \"phone_number\":this.state.phoneNumber,\r\n        \"billing_address\": this.state.deliveryAddress,\r\n        \"shipping_address\": this.state.billingAddress,\r\n        \"waiver\":this.state.waiver,\r\n        \"entryway_photo\": this.state.entrywayPhoto,\r\n        \"step_left_photo\": this.state.stepLeftPhoto,\r\n        \"step_right_photo\": this.state.stepRightPhoto,\r\n        \"step_left_height\":this.state.leftStepHeight,\r\n        \"step_right_height\":this.state.rightStepHeight,\r\n        \"ramp_colour\":this.state.rampColor,\r\n        \"delivery_method\":this.state.deliveryType,\r\n        \"subsidize\":this.state.subsidize,\r\n        \"status\":0,\r\n\t\t\"notes\":\"[]\"\r\n        }\r\n\r\n        this.props.verifyTokens().then(valid => {\r\n            if (!valid)\r\n                return;\r\n            const token = localStorage.getItem('token-access')\r\n            const requestOptions = {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Accept': 'application/json',\r\n                    'Authorization': 'Bearer ' + token\r\n                    \r\n                },\r\n                body: JSON.stringify(data)\r\n                \r\n            };\r\n            fetch('/order-information/', requestOptions)\r\n            .then(async response => {\r\n                const data = await response.json();\r\n\r\n                // check for error response\r\n                if (!response.ok) {\r\n                    // get error message from body or default to response status\r\n                    const error = (data && data.message) || response.status;\r\n                    return Promise.reject(error);\r\n                }\r\n                \r\n            })\r\n            .catch(error => {\r\n                this.setState({ errorMessage: error });\r\n                console.error('There was an error!', error);\r\n                console.log( error);\r\n            }); \r\n        });\r\n    }\r\n\t\r\n\thandleSubmitWaiver = () => {\r\n      \r\n\t\tconst data ={\r\n        //\"pk\":1,\r\n       \r\n\t\t\"user\":this.state.user,\r\n        \"signatory_first_name\":this.state.managerFirst,\r\n        \"signatory_last_name\":this.state.managerFirst,\r\n        \"signatory_signature\":this.state.witnessSig,\r\n        \"witness_first_name\":this.state.witnessName,\r\n        \"witness_last_name\":this.state.witnessName,\r\n        \"witness_signature\":this.state.witnessSig}\r\n\r\n        this.props.verifyTokens().then(valid => {\r\n            if (!valid)\r\n                return;\r\n            const token = localStorage.getItem('token-access')\r\n            console.log(token);\r\n            const requestOptions = {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': 'Bearer ' + token\r\n                },\r\n                body: JSON.stringify(data)\r\n            };\r\n            fetch('/waiver-information/', requestOptions)\r\n            .then(async response => {\r\n                const data = await response.json();\r\n    \r\n                // check for error response\r\n                if (!response.ok) {\r\n                    // get error message from body or default to response status\r\n                    const error = (data && data.message) || response.status;\r\n                    return Promise.reject(error);\r\n                }\r\n        \r\n                this.setState({ waiver: data.pk })\r\n                this.handleSubmitOrder()\r\n            })\r\n            .catch(error => {\r\n                this.setState({ errorMessage: error });\r\n                console.error('There was an error!', JSON.stringify(data));\r\n            }); \r\n        });\r\n\t}\r\n\r\n    render() {\r\n        const { step } = this.state;\r\n        \r\n   \r\n\r\n        switch (step) {\r\n            case 0:\r\n                return <Redirect to=\"/dashboard\" />\r\n            case 1: \r\n                return (\r\n                    <FormUserDetails\r\n                        prevStep={this.prevStep}\r\n                        nextStep={this.nextStep}\r\n                        handleChange={this.handleChange}\r\n\t\t\t\t\t\thandleCheck={this.handleCheck}\r\n                    \r\n                    />\r\n                )\r\n            case 2:\r\n                return (\r\n                    <ImageUpload\r\n\t\t\t\t\t\tprevStep={this.prevStep}\r\n                        nextStep={this.nextStep}\r\n                        handlePicture={this.handlePicture}\r\n                        handleChange={this.handleChange}\r\n                        Uploaded = {this.state.Uploaded}\r\n                    />\r\n                )\r\n            case 3:\r\n                return (\r\n                    <LiabilityWaiver\r\n                        nextStep={this.nextStep}\r\n                        prevStep={this.prevStep}\r\n\t\t\t\t\t\thandleSubmitWaiver={this.handleSubmitWaiver}\r\n                        handleSubmitOrder={this.handleSubmitOrder}\r\n                        handleUser={this.handleUser}\r\n                        handleChange={this.handleChange}\r\n                    />\r\n                )\r\n            case 4: \r\n                return (\r\n                    <div>\r\n                        <h1> Thank you! We'll be in contact about your request.</h1>\r\n                        <Link to=\"/dashboard\">\r\n                            Go back home.\r\n                        </Link>\r\n                    </div>\r\n                )\r\n            default:\r\n                return <Redirect to=\"/dashboard\" />\r\n        }\r\n        // return (\r\n        //     <div>\r\n                \r\n        //     </div>\r\n        \r\n    }\r\n}\r\n\r\nexport default UserForm;\r\n"]},"metadata":{},"sourceType":"module"}