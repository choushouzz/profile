{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import FormUserDetails from'./FormUserDetails';import ImageUpload from'./ImageUpload';import LiabilityWaiver from'./LiabilityWaiver';import{Redirect,Link}from'react-router-dom';export var UserForm=/*#__PURE__*/function(_Component){_inherits(UserForm,_Component);var _super=_createSuper(UserForm);function UserForm(props){var _this;_classCallCheck(this,UserForm);_this=_super.call(this,props);_this.nextStep=function(){var step=_this.state.step;_this.setState({step:step+1});};_this.prevStep=function(){var step=_this.state.step;_this.setState({step:step-1});};_this.handleChange=function(input){return function(e){_this.setState(_defineProperty({},input,e.target.value));};};_this.handleCheck=function(input){return function(e){_this.setState(_defineProperty({},input,!_this.state.subsidize));};};_this.handleUser=function(){fetch(\"/users\",{method:'GET',headers:{'Accept':'application/json','Authorization':\"Bearer \".concat(localStorage.getItem('token-access'))}}).then(function(res){if(res.ok)return res.json();throw new Error(\"Something went wrong with error code \".concat(res.status));}).then(function(result){var users=result[\"results\"];var id;users.map(function(x){if(x[\"username\"]==_this.props.username){id=x[\"pk\"];}});_this.setState({isLoaded:true,user:id});_this.handleSubmitWaiver();},// Note: it's important to handle errors here\n// instead of a catch() block so that we don't swallow\n// exceptions from actual bugs in components.\nfunction(error){_this.setState({isLoaded:true,error:error});});};_this.handleSubmitOrder=function(){var data={// \"pk\":1,\n\"user\":_this.state.user,\"first_name\":_this.state.firstName,\"last_name\":_this.state.lastName,\"email\":_this.state.email,\"company\":_this.state.companyName,\"phone_number\":_this.state.phoneNumber,\"billing_address\":_this.state.deliveryAddress,\"shipping_address\":_this.state.billingAddress,\"waiver\":_this.state.waiver,\"entryway_photo\":_this.state.entrywayPhoto,\"step_left_photo\":_this.state.stepLeftPhoto,\"step_right_photo\":_this.state.stepRightPhoto,\"step_left_height\":_this.state.leftStepHeight,\"step_right_height\":_this.state.rightStepHeight,\"ramp_colour\":_this.state.rampColor,\"delivery_method\":_this.state.deliveryType,\"subsidize\":_this.state.subsidize,\"status\":\"Request Recieved\",\"notes\":\"There is no notes now\"};var token=localStorage.getItem('token-access');var requestOptions={method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(data)};fetch('/order-information/',requestOptions).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var data,error;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return response.json();case 2:data=_context.sent;console.log(response);console.log(data);// check for error response\nif(response.ok){_context.next=8;break;}// get error message from body or default to response status\nerror=data&&data.message||response.status;return _context.abrupt(\"return\",Promise.reject(error));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){_this.setState({errorMessage:error});console.error('There was an error!',error);console.log(error);});};_this.handleSubmitWaiver=function(){console.log(_this.state.user);var data={//\"pk\":1,\n\"user\":_this.state.user,\"signatory_first_name\":_this.state.managerFirst,\"signatory_last_name\":_this.state.managerFirst,\"signatory_signature\":_this.state.witnessSig,\"witness_first_name\":_this.state.witnessName,\"witness_last_name\":_this.state.witnessName,\"witness_signature\":_this.state.witnessSig};var token=localStorage.getItem('token-access');var requestOptions={method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify(data)};fetch('/waiver-information/',requestOptions).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response){var data,error;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return response.json();case 2:data=_context2.sent;if(response.ok){_context2.next=6;break;}// get error message from body or default to response status\nerror=data&&data.message||response.status;return _context2.abrupt(\"return\",Promise.reject(error));case 6:console.log(data.pk);_this.setState({waiver:data.pk});_this.handleSubmitOrder();case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){_this.setState({errorMessage:error});console.error('There was an error!',error);});};_this.state={step:1,firstName:'',lastName:'',email:'',companyName:'',phoneNumber:'',deliveryAddress:'',deliveryType:'',rampColor:'',managerFirst:'',managerSig:'',witnessName:'',witnessSig:'',entrywayPhoto:'',stepLeftPhoto:'',stepRightPhoto:'',leftStepHeight:'',rightStepHeight:'',subsidize:false,waiver:'',user:'',isLoaded:false,Uploaded:false};_this.handlePicture=_this.handlePicture.bind(_assertThisInitialized(_this));return _this;}_createClass(UserForm,[{key:\"handlePicture\",value:function handlePicture(input,url){if(input==\"entrywayPhoto\"){this.setState({entrywayPhoto:url});}else if(input==\"stepLeftPhoto\"){this.setState({stepLeftPhoto:url});}else if(input==\"stepRightPhoto\"){this.setState({stepRightPhoto:url});}if(this.state.rightStepHeight!=''&&this.state.leftStepHeight!=''&&this.state.entrywayPhoto!=''&&this.state.stepLeftPhoto!=''&&this.state.stepRightPhoto!=''){this.setState({Uploaded:true});}}},{key:\"render\",value:function render(){var step=this.state.step;switch(step){case 0:return/*#__PURE__*/React.createElement(Redirect,{to:\"/dashboard\"});case 1:return/*#__PURE__*/React.createElement(FormUserDetails,{prevStep:this.prevStep,nextStep:this.nextStep,handleChange:this.handleChange,handleCheck:this.handleCheck});case 2:return/*#__PURE__*/React.createElement(ImageUpload,{prevStep:this.prevStep,nextStep:this.nextStep,handlePicture:this.handlePicture,handleChange:this.handleChange,Uploaded:this.state.Uploaded});case 3:return/*#__PURE__*/React.createElement(LiabilityWaiver,{nextStep:this.nextStep,prevStep:this.prevStep,handleSubmitWaiver:this.handleSubmitWaiver,handleSubmitOrder:this.handleSubmitOrder,handleUser:this.handleUser,handleChange:this.handleChange});case 4:return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\" Thank you! We'll be in contact about your request.\"),/*#__PURE__*/React.createElement(Link,{to:\"/dashboard\"},\"Go back home.\"));default:return/*#__PURE__*/React.createElement(Redirect,{to:\"/dashboard\"});}// return (\n//     <div>\n//     </div>\n}}]);return UserForm;}(Component);export default UserForm;","map":{"version":3,"sources":["C:/Users/owner/desktop/team/app/src/components/react-components/RequestForm/index.js"],"names":["React","Component","FormUserDetails","ImageUpload","LiabilityWaiver","Redirect","Link","UserForm","props","nextStep","step","state","setState","prevStep","handleChange","input","e","target","value","handleCheck","subsidize","handleUser","fetch","method","headers","localStorage","getItem","then","res","ok","json","Error","status","result","users","id","map","x","username","isLoaded","user","handleSubmitWaiver","error","handleSubmitOrder","data","firstName","lastName","email","companyName","phoneNumber","deliveryAddress","billingAddress","waiver","entrywayPhoto","stepLeftPhoto","stepRightPhoto","leftStepHeight","rightStepHeight","rampColor","deliveryType","token","requestOptions","body","JSON","stringify","response","console","log","message","Promise","reject","catch","errorMessage","managerFirst","witnessSig","witnessName","pk","managerSig","Uploaded","handlePicture","bind","url"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport FormUserDetails from './FormUserDetails';\r\nimport ImageUpload from './ImageUpload';\r\nimport LiabilityWaiver from './LiabilityWaiver';\r\nimport { Redirect, Link } from 'react-router-dom';\r\n\r\nexport class UserForm extends Component {\r\n\r\n    constructor(props) {\r\n        super(props)\r\n\r\n        \r\n\r\n        this.state = {\r\n            step: 1, \r\n            firstName: '',\r\n            lastName: '',\r\n            email: '',\r\n            companyName: '',\r\n            phoneNumber: '', \r\n            deliveryAddress: '',\r\n            deliveryType: '',\r\n            rampColor: '',\r\n            managerFirst: '',\r\n            managerSig: '',\r\n            witnessName: '',\r\n            witnessSig: '',\r\n            entrywayPhoto: '',\r\n            stepLeftPhoto: '',\r\n            stepRightPhoto: '',\r\n            leftStepHeight:'',\r\n            rightStepHeight:'',\r\n            subsidize: false,\r\n            waiver:'',\r\n            user: '',\r\n            isLoaded: false,\r\n            Uploaded:false,\r\n        }\r\n\r\n        this.handlePicture = this.handlePicture.bind(this)\r\n    }\r\n\r\n\r\n    nextStep = () => {\r\n        const { step } = this.state;\r\n        this.setState({\r\n            step: step + 1\r\n        });\r\n    }\r\n\r\n    prevStep = () => {\r\n        const { step } = this.state;\r\n        this.setState({\r\n            step: step - 1\r\n        });\r\n    }\r\n    // Handle Field Changes\r\n    handleChange = input => e => {\r\n        this.setState({[input]: e.target.value})\r\n    }\r\n\t\r\n\thandleCheck = input => e => {\r\n        this.setState({[input]: !this.state.subsidize})\r\n    }\r\n\r\n    handlePicture(input, url) {\r\n\r\n        \r\n\r\n        if (input == \"entrywayPhoto\") {\r\n            this.setState({\r\n                entrywayPhoto: url\r\n            });\r\n        } else if (input == \"stepLeftPhoto\") {\r\n            this.setState({\r\n                stepLeftPhoto: url\r\n            });\r\n        } else if (input == \"stepRightPhoto\") {\r\n            this.setState({\r\n                stepRightPhoto: url\r\n            });\r\n        }\r\n\r\n        if (this.state.rightStepHeight != '' && this.state.leftStepHeight != ''  &&\r\n        this.state.entrywayPhoto != '' && this.state.stepLeftPhoto != '' && this.state.stepRightPhoto != ''){\r\n            this.setState({\r\n                Uploaded: true\r\n            });\r\n            \r\n        }\r\n    }\r\n\r\n\r\n    handleUser = () => {\r\n        fetch(\"/users\", {\r\n            method: 'GET',\r\n            headers: {\r\n              'Accept': 'application/json',\r\n              'Authorization': `Bearer ${localStorage.getItem('token-access')}`\r\n            }\r\n          })\r\n          .then(res => {\r\n            if (res.ok)\r\n              return res.json()\r\n            throw new Error(`Something went wrong with error code ${res.status}`)\r\n          })\r\n          .then(\r\n            (result) => {\r\n              const users = result[\"results\"];\r\n              var id\r\n              users.map(x => {\r\n                if (x[\"username\"] == this.props.username){\r\n                    id = x[\"pk\"]\r\n      \r\n                    \r\n                }\r\n              })\r\n              this.setState({\r\n                isLoaded: true,\r\n                user:id\r\n              });\r\n              this.handleSubmitWaiver()\r\n            },\r\n            // Note: it's important to handle errors here\r\n            // instead of a catch() block so that we don't swallow\r\n            // exceptions from actual bugs in components.\r\n            (error) => {\r\n              this.setState({\r\n                isLoaded: true,\r\n                error\r\n              });\r\n            }\r\n          )\r\n    }\r\n\t\r\n    handleSubmitOrder = () => {\r\n        const data ={\r\n        // \"pk\":1,\r\n        \"user\":this.state.user,\r\n        \"first_name\":this.state.firstName,\r\n        \"last_name\":this.state.lastName,\r\n        \"email\":this.state.email,\r\n        \"company\":this.state.companyName,\r\n        \"phone_number\":this.state.phoneNumber,\r\n        \"billing_address\": this.state.deliveryAddress,\r\n        \"shipping_address\": this.state.billingAddress,\r\n        \"waiver\":this.state.waiver,\r\n        \"entryway_photo\": this.state.entrywayPhoto,\r\n        \"step_left_photo\": this.state.stepLeftPhoto,\r\n        \"step_right_photo\": this.state.stepRightPhoto,\r\n        \"step_left_height\":this.state.leftStepHeight,\r\n        \"step_right_height\":this.state.rightStepHeight,\r\n        \"ramp_colour\":this.state.rampColor,\r\n        \"delivery_method\":this.state.deliveryType,\r\n        \"subsidize\":this.state.subsidize,\r\n        \"status\":\"Request Recieved\",\r\n\t\t\"notes\":\"There is no notes now\"\r\n        }\r\n\r\n\r\n\t\tconst token = localStorage.getItem('token-access')\r\n        const requestOptions = {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Accept': 'application/json',\r\n                'Authorization': 'Bearer ' + token\r\n               \r\n\t\t\t},\r\n            body: JSON.stringify(data)\r\n         \r\n        };\r\n        fetch('/order-information/', requestOptions)\r\n            .then(async response => {\r\n                const data = await response.json();\r\n                console.log(response)\r\n                console.log(data)\r\n    \r\n                // check for error response\r\n                if (!response.ok) {\r\n                    // get error message from body or default to response status\r\n                    const error = (data && data.message) || response.status;\r\n                    return Promise.reject(error);\r\n                }\r\n\t\t\t\t\r\n            })\r\n            .catch(error => {\r\n                this.setState({ errorMessage: error });\r\n                console.error('There was an error!', error);\r\n                console.log( error);\r\n            }); \r\n    }\r\n\t\r\n\thandleSubmitWaiver = () => {\r\n        console.log(this.state.user)\r\n\t\tconst data ={\r\n        //\"pk\":1,\r\n       \r\n\t\t\"user\":this.state.user,\r\n        \"signatory_first_name\":this.state.managerFirst,\r\n        \"signatory_last_name\":this.state.managerFirst,\r\n        \"signatory_signature\":this.state.witnessSig,\r\n        \"witness_first_name\":this.state.witnessName,\r\n        \"witness_last_name\":this.state.witnessName,\r\n        \"witness_signature\":this.state.witnessSig}\r\n\r\n\t\tconst token = localStorage.getItem('token-access')\r\n        const requestOptions = {\r\n            method: 'POST',\r\n            headers: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t'Authorization': 'Bearer ' + token\r\n\t\t\t},\r\n            body: JSON.stringify(data)\r\n        };\r\n        fetch('/waiver-information/', requestOptions)\r\n            .then(async response => {\r\n                const data = await response.json();\r\n    \r\n                // check for error response\r\n                if (!response.ok) {\r\n                    // get error message from body or default to response status\r\n                    const error = (data && data.message) || response.status;\r\n                    return Promise.reject(error);\r\n                }\r\n\t\t\t\tconsole.log(data.pk)\r\n                this.setState({ waiver: data.pk })\r\n                this.handleSubmitOrder()\r\n            })\r\n            .catch(error => {\r\n                this.setState({ errorMessage: error });\r\n                console.error('There was an error!', error);\r\n            }); \r\n\t}\r\n\r\n    render() {\r\n        const { step } = this.state;\r\n        \r\n   \r\n\r\n        switch (step) {\r\n            case 0:\r\n                return <Redirect to=\"/dashboard\" />\r\n            case 1: \r\n                return (\r\n                    <FormUserDetails\r\n                        prevStep={this.prevStep}\r\n                        nextStep={this.nextStep}\r\n                        handleChange={this.handleChange}\r\n\t\t\t\t\t\thandleCheck={this.handleCheck}\r\n                    \r\n                    />\r\n                )\r\n            case 2:\r\n                return (\r\n                    <ImageUpload\r\n\t\t\t\t\t\tprevStep={this.prevStep}\r\n                        nextStep={this.nextStep}\r\n                        handlePicture={this.handlePicture}\r\n                        handleChange={this.handleChange}\r\n                        Uploaded = {this.state.Uploaded}\r\n                    />\r\n                )\r\n            case 3:\r\n                return (\r\n                    <LiabilityWaiver\r\n                        nextStep={this.nextStep}\r\n                        prevStep={this.prevStep}\r\n\t\t\t\t\t\thandleSubmitWaiver={this.handleSubmitWaiver}\r\n                        handleSubmitOrder={this.handleSubmitOrder}\r\n                        handleUser={this.handleUser}\r\n                        handleChange={this.handleChange}\r\n                    />\r\n                )\r\n            case 4: \r\n                return (\r\n                    <div>\r\n                        <h1> Thank you! We'll be in contact about your request.</h1>\r\n                        <Link to=\"/dashboard\">\r\n                            Go back home.\r\n                        </Link>\r\n                    </div>\r\n                )\r\n            default:\r\n                return <Redirect to=\"/dashboard\" />\r\n        }\r\n        // return (\r\n        //     <div>\r\n                \r\n        //     </div>\r\n        \r\n    }\r\n}\r\n\r\nexport default UserForm;\r\n"]},"metadata":{},"sourceType":"module"}