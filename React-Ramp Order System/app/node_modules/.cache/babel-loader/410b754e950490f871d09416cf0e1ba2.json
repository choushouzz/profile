{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\owner\\\\Desktop\\\\team\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{render}from\"react-dom\";import{Route,Switch,BrowserRouter,Redirect}from'react-router-dom';import'./App.css';import Login from'./react-components/Login';import Dashboard from'./react-components/Dashboard';import UserForm from'./react-components/RequestForm';import{LinearProgress}from'@material-ui/core';var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.login=function(user,pwd,isAdmin){console.log(\"StopGap: Logging in...\");if(_this.state.loggedIn){//already logged in.\nconsole.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false});_this.setState({loggedIn:true});return;}// validate token\nfetch(\"/api/token/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":user,\"password\":pwd})}).then(function(res){return res.json();}).then(function(res){console.log(res);if('detail'in res){localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');_this.setState({loggedIn:false,invalidLogin:true,loginMsg:\"Login credentials not valid.\"});}else if('access'in res&&'refresh'in res&&'user'in res&&'isAdmin'in res){// First check if the user is of the correct account type (that is, only clients can access the client dashboard and vice versa)\nif(res.isAdmin!=isAdmin){_this.setState({loggedIn:false,invalidLogin:true,loginMsg:\"Attempting to use a\".concat(res.isAdmin?\"n admin\":\" client\",\" account to access the \").concat(isAdmin?\"admin\":\"client\",\" dashboard\")});}else{localStorage.setItem('token-access',res.access);localStorage.setItem('token-refresh',res.refresh);localStorage.setItem('username',res.user);localStorage.setItem('is-admin',res.isAdmin);_this.setState({loggedIn:true,isAdmin:isAdmin,invalidLogin:false,loginMsg:\"\"});}}},function(err){_this.setState({loggedIn:false,invalidLogin:true,loginMsg:\"An error occurred while attempting to validate login credentials.\"});console.error(err);});};_this.register=function(username,password,first_name,last_name,isAdmin){console.log(\"StopGap: Registering new user...\");// User already logged in.\nif(_this.state.loggedIn){console.error(\"Stopgap: user already logged in.\");// Refreshes the page\n_this.setState({loggedIn:false});_this.setState({loggedIn:true});return;}// Register user using Django API\nfetch(\"/users/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({\"username\":username,\"password\":password,\"email\":username,\"first_name\":first_name,\"last_name\":last_name,\"is_staff\":isAdmin})}).then(function(res){// Login user with newly created credentials\n_this.login(username,password,isAdmin);});};_this.logout=function(){_this.setState({loggedIn:false,isAdmin:false,invalidLogin:false,loginMsg:\"\",username:\"\"});localStorage.removeItem('token-access');localStorage.removeItem('token-refresh');localStorage.removeItem('username');localStorage.removeItem('is-admin');};_this.state={loggedIn:false,// by default, no one is logged in\ninvalidLogin:false,loginMsg:\"\",isAdmin:false,// TODO: properly store this\nisCurrentlyCheckingStorageForLogin:true,error:null,isLoaded:false};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var accessToken=localStorage.hasOwnProperty(\"token-access\")?localStorage.getItem(\"token-access\"):\"\";var refreshToken=localStorage.hasOwnProperty(\"token-refresh\")?localStorage.getItem(\"token-refresh\"):\"\";// check if the existing access token is valid.\n// If not, attempt to retrieve a new one using the refresh token\nfetch(\"/api/token/verify/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({token:accessToken})}).then(function(res){if(res.ok){console.log(\"Access Token: \".concat(accessToken));_this2.setState({loggedIn:true,isCurrentlyCheckingStorageForLogin:false});return;}// token is NOT valid, so attempt to refresh.\nfetch(\"/api/token/refresh/\",{method:'POST',headers:{'Accept':'application/json','Content-type':'application/json'},body:JSON.stringify({refresh:refreshToken})}).then(function(res){if('access'in res){localStorage.setItem(\"token-access\",res.access);_this2.setState({loggedIn:true,isCurrentlyCheckingStorageForLogin:false});}else{_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});}},function(error){// REFRESH ERROR\nconsole.error(error);_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});});},function(error){// VERIFY ERROR\nconsole.error(error);_this2.setState({loggedIn:false,isCurrentlyCheckingStorageForLogin:false});});}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(Switch,null,\" \",/*#__PURE__*/React.createElement(Route,{path:\"/login\",render:function render(){return/*#__PURE__*/React.createElement(Login,{loggedIn:_this3.state.loggedIn,login:_this3.login,logout:_this3.logout,register:_this3.register,isAdmin:_this3.state.isAdmin,invalidLogin:_this3.state.invalidLogin,loginMsg:_this3.state.loginMsg});}}),/*#__PURE__*/React.createElement(Route,{path:\"/dashboard\",render:function render(){return _this3.state.loggedIn?/*#__PURE__*/React.createElement(Dashboard,{loggedIn:_this3.state.loggedIn,logout:_this3.logout}):/*#__PURE__*/React.createElement(Redirect,{to:\"/login\"});}}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/form\",render:function render(){return/*#__PURE__*/React.createElement(UserForm,{username:_this3.state.username});}}),/*#__PURE__*/React.createElement(Route,{path:\"/\",render:function render(){return _this3.state.isCurrentlyCheckingStorageForLogin?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\"Loading . . .\"),/*#__PURE__*/React.createElement(LinearProgress,null)):/*#__PURE__*/React.createElement(Redirect,{path:\"/\",to:_this3.state.loggedIn?\"/dashboard\":\"/login\"});}}))));}}]);return App;}(React.Component);export default App;var container=document.getElementById(\"root\");render(/*#__PURE__*/React.createElement(App,null),container);","map":{"version":3,"sources":["C:/Users/owner/desktop/team/app/src/components/App.js"],"names":["React","render","Route","Switch","BrowserRouter","Redirect","Login","Dashboard","UserForm","LinearProgress","App","props","login","user","pwd","isAdmin","console","log","state","loggedIn","error","setState","fetch","method","headers","body","JSON","stringify","then","res","json","localStorage","removeItem","invalidLogin","loginMsg","setItem","access","refresh","err","register","username","password","first_name","last_name","logout","isCurrentlyCheckingStorageForLogin","isLoaded","accessToken","hasOwnProperty","getItem","refreshToken","token","ok","Component","container","document","getElementById"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { render } from \"react-dom\";\r\nimport { Route, Switch, BrowserRouter, Redirect } from 'react-router-dom';\r\nimport './App.css';\r\nimport Login from './react-components/Login';\r\nimport Dashboard from './react-components/Dashboard';\r\nimport UserForm from './react-components/RequestForm';\r\nimport { LinearProgress } from '@material-ui/core';\r\nclass App extends React.Component {\r\n\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      loggedIn: false, // by default, no one is logged in\r\n      invalidLogin: false,\r\n      loginMsg: \"\",\r\n      isAdmin: false, // TODO: properly store this\r\n      isCurrentlyCheckingStorageForLogin: true,\r\n      error: null,\r\n      isLoaded: false,\r\n      \r\n    };\r\n  }\r\n\r\n  login = (user, pwd, isAdmin) => {\r\n    console.log(\"StopGap: Logging in...\");\r\n    if (this.state.loggedIn){ //already logged in.\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false,\r\n      });\r\n      this.setState({\r\n        loggedIn: true,\r\n      });\r\n      return;\r\n    }\r\n    // validate token\r\n    fetch(\"/api/token/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": user,\r\n        \"password\": pwd\r\n      })\r\n    })\r\n    .then(res => res.json())\r\n    .then(res => {\r\n      console.log(res)\r\n      if ('detail' in res){\r\n        localStorage.removeItem('token-access')\r\n        localStorage.removeItem('token-refresh')\r\n        this.setState({\r\n          loggedIn: false,\r\n          invalidLogin: true,\r\n          loginMsg: \"Login credentials not valid.\"\r\n        });\r\n      } else if ('access' in res && 'refresh' in res && 'user' in res && 'isAdmin' in res){\r\n        // First check if the user is of the correct account type (that is, only clients can access the client dashboard and vice versa)\r\n        if (res.isAdmin != isAdmin){\r\n          this.setState({\r\n            loggedIn: false,\r\n            invalidLogin: true,\r\n            loginMsg: `Attempting to use a${res.isAdmin ? \"n admin\" : \" client\"} account to access the ${isAdmin ? \"admin\" : \"client\"} dashboard`\r\n          });\r\n        } else {\r\n          localStorage.setItem('token-access', res.access);\r\n          localStorage.setItem('token-refresh', res.refresh);\r\n          localStorage.setItem('username', res.user);\r\n          localStorage.setItem('is-admin', res.isAdmin);\r\n          this.setState({\r\n            loggedIn: true,\r\n            isAdmin: isAdmin,\r\n            invalidLogin: false,\r\n            loginMsg: \"\"\r\n          });\r\n        }\r\n      }\r\n    }, err => {\r\n      this.setState({\r\n        loggedIn: false,\r\n        invalidLogin: true,\r\n        loginMsg: \"An error occurred while attempting to validate login credentials.\"\r\n      });\r\n      console.error(err);\r\n    })\r\n  }\r\n\r\n  register = (username, password, first_name, last_name, isAdmin) => {\r\n    console.log(\"StopGap: Registering new user...\");\r\n\r\n    // User already logged in.\r\n    if (this.state.loggedIn){\r\n      console.error(\"Stopgap: user already logged in.\");\r\n      // Refreshes the page\r\n      this.setState({\r\n        loggedIn: false\r\n      });\r\n      this.setState({\r\n        loggedIn: true,\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Register user using Django API\r\n    fetch(\"/users/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        \"username\": username,\r\n        \"password\": password,\r\n        \"email\": username,\r\n        \"first_name\": first_name,\r\n        \"last_name\": last_name,\r\n        \"is_staff\": isAdmin\r\n      })\r\n    }).then(res => {\r\n      // Login user with newly created credentials\r\n      this.login(username, password, isAdmin);\r\n    });\r\n  }\r\n\r\n  logout = () => {\r\n    this.setState({\r\n      loggedIn: false,\r\n      isAdmin: false,\r\n      invalidLogin: false,\r\n      loginMsg: \"\",\r\n      username:\"\"\r\n    });\r\n    localStorage.removeItem('token-access');\r\n    localStorage.removeItem('token-refresh');\r\n    localStorage.removeItem('username');\r\n    localStorage.removeItem('is-admin');          \r\n  }\r\n  \r\n  componentDidMount() {\r\n    const accessToken = localStorage.hasOwnProperty(\"token-access\") \r\n      ? localStorage.getItem(\"token-access\") : \"\";\r\n    const refreshToken = localStorage.hasOwnProperty(\"token-refresh\") \r\n      ? localStorage.getItem(\"token-refresh\") : \"\";\r\n    // check if the existing access token is valid.\r\n    // If not, attempt to retrieve a new one using the refresh token\r\n    fetch(\"/api/token/verify/\", {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        token: accessToken\r\n      })\r\n    })\r\n    .then( res => {\r\n      if (res.ok){\r\n        console.log(`Access Token: ${accessToken}`)\r\n        this.setState({\r\n          loggedIn: true,\r\n          isCurrentlyCheckingStorageForLogin: false\r\n        });\r\n        return;\r\n      }\r\n\r\n      // token is NOT valid, so attempt to refresh.\r\n      fetch(\"/api/token/refresh/\", {\r\n        method: 'POST',\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'Content-type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          refresh: refreshToken\r\n        })\r\n      })\r\n      .then(res => {\r\n          if ('access' in res){\r\n            localStorage.setItem(\"token-access\", res.access)\r\n            this.setState({\r\n              loggedIn: true,\r\n              isCurrentlyCheckingStorageForLogin: false\r\n            })\r\n          } else {\r\n            this.setState({\r\n              loggedIn: false,\r\n              isCurrentlyCheckingStorageForLogin: false\r\n            })\r\n          }\r\n      }, error => { // REFRESH ERROR\r\n        console.error(error)\r\n        this.setState({\r\n          loggedIn: false,\r\n          isCurrentlyCheckingStorageForLogin: false\r\n        })\r\n      })\r\n    }, error => { // VERIFY ERROR\r\n      console.error(error)\r\n      this.setState({\r\n        loggedIn: false,\r\n        isCurrentlyCheckingStorageForLogin: false\r\n      })\r\n    });\r\n  }\r\n\r\n  render() { \r\n      return (\r\n        <div> \r\n          <BrowserRouter>\r\n            <Switch> { /* Similar to a switch statement - shows the component depending on the URL path */ }\r\n              { /* Each Route below shows a different component depending on the exact path in the URL  */ }\r\n              <Route\r\n                path='/login'\r\n                render={() => (\r\n                  <Login loggedIn={this.state.loggedIn}\r\n                  login={this.login}\r\n                  logout={this.logout}\r\n                  register={this.register}\r\n                  isAdmin={this.state.isAdmin}\r\n                  invalidLogin={this.state.invalidLogin}\r\n                  loginMsg={this.state.loginMsg} />\r\n                )}\r\n              />\r\n              <Route path='/dashboard' render={() => (\r\n                this.state.loggedIn \r\n                  ? <Dashboard loggedIn={this.state.loggedIn} logout={this.logout} />\r\n                  : <Redirect to='/login' />\r\n              )} />\r\n              <Route exact path='/form' render={() => (<UserForm username ={this.state.username} />)}/>\r\n              <Route path='/' render={() => (\r\n                this.state.isCurrentlyCheckingStorageForLogin \r\n                  ? (<div>\r\n                      <h1>Loading . . .</h1>\r\n                      <LinearProgress />\r\n                    </div>)\r\n                  : <Redirect path='/' to={this.state.loggedIn ? \"/dashboard\" : \"/login\" } />\r\n              )} />\r\n            </Switch>\r\n            \r\n          </BrowserRouter>\r\n        </div>\r\n      )\r\n  }\r\n}\r\n\r\n\r\nexport default App;\r\nconst container = document.getElementById(\"root\");\r\nrender(<App />, container);\r\n"]},"metadata":{},"sourceType":"module"}